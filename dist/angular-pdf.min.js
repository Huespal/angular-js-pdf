!function(){"use strict";angular.module("pdf",[]).directive("ngPdf",["$window",function(e){var t=null,n=null,a=!1,o=function(e){var t=e.getContext("2d"),n=window.devicePixelRatio||1,a=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return n/a},r=function(e,t,n){var a=o(e);return e.width=Math.floor(t*a),e.height=Math.floor(n*a),e.style.width=Math.floor(t)+"px",e.style.height=Math.floor(n)+"px",e.getContext("2d").setTransform(a,0,0,a,0,0),e};return{restrict:"E",templateUrl:function(e,t){return t.templateUrl?t.templateUrl:"partials/viewer.html"},link:function(o,i,l){function s(){w&&w.clearRect(0,0,P.width,P.height)}function c(){s();var e={url:p,withCredentials:m};g&&(e.httpHeaders=g),p&&p.length&&(n=PDFJS.getDocument(e,null,null,o.onProgress),n.then(function(e){"function"==typeof o.onLoad&&o.onLoad(),u=e,o.renderPage(o.pageToDisplay),o.$apply(function(){o.pageCount=e.numPages})},function(e){e&&"function"==typeof o.onError&&o.onError(e)}))}i.css("display","block");var p=o.pdfUrl,g=o.httpHeaders,u=null,d=isFinite(l.page)?parseInt(l.page):1,f="page-fit"===l.scale,h=l.scale>0?l.scale:1,y=l.canvasid||"pdf-canvas",P=document.getElementById(y);a=l.hasOwnProperty("debug")?l.debug:!1;var m=l.usecredentials,w=P.getContext("2d"),D=angular.element(e);D.on("scroll",function(){o.$apply(function(){o.scroll=D[0].scrollY})}),PDFJS.disableWorker=!0,o.pageNum=d,o.renderPage=function(e){t&&t._internalRenderTask.cancel(),u.getPage(e).then(function(e){var n,a,l;if(f){n=e.getViewport(1);var s=i[0].getBoundingClientRect();a=s.width/n.width,h=a}n=e.getViewport(h),r(P,n.width,n.height),l={canvasContext:w,viewport:n},t=e.render(l),t.promise.then(function(){"function"==typeof o.onPageRender&&o.onPageRender()})["catch"](function(e){console.log(e)})})},o.$on("goPrevious",function(){o.pageToDisplay<=1||(o.pageToDisplay=parseInt(o.pageToDisplay)-1,o.pageNum=o.pageToDisplay)}),o.$on("goNext",function(){o.pageToDisplay>=u.numPages||(o.pageToDisplay=parseInt(o.pageToDisplay)+1,o.pageNum=o.pageToDisplay)}),o.$on("zoomIn",function(){return f=!1,h=parseFloat(h)+.2,o.renderPage(o.pageToDisplay),h}),o.$on("zoomOut",function(){return f=!1,h=parseFloat(h)-.2,o.renderPage(o.pageToDisplay),h}),o.$on("fit",function(){f=!0,o.renderPage(o.pageToDisplay)}),o.$on("changePage",function(){o.renderPage(o.pageToDisplay)}),o.$on("rotate",function(){"rotate0"===P.getAttribute("class")?P.setAttribute("class","rotate90"):"rotate90"===P.getAttribute("class")?P.setAttribute("class","rotate180"):"rotate180"===P.getAttribute("class")?P.setAttribute("class","rotate270"):P.setAttribute("class","rotate0")}),o.$watch("pageNum",function(e){o.pageToDisplay=parseInt(e),null!==u&&o.renderPage(o.pageToDisplay)}),o.$watch("pdfUrl",function(e){""!==e&&(a&&console.log("pdfUrl value change detected: ",o.pdfUrl),p=e,o.pageNum=o.pageToDisplay=d,n?n.destroy().then(function(){c()}):c())})}}}])}();
