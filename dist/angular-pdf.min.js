!function(){"use strict";angular.module("pdf",[]).directive("ngPdf",["$window",function(e){var t=null,n=null,a=!1,o=function(e){var t=e.getContext("2d"),n=window.devicePixelRatio||1,a=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return n/a},r=function(e,t,n){var a=o(e);return e.width=Math.floor(t*a),e.height=Math.floor(n*a),e.style.width=Math.floor(t)+"px",e.style.height=Math.floor(n)+"px",e.getContext("2d").setTransform(a,0,0,a,0,0),e};return{restrict:"E",templateUrl:function(e,t){return t.templateUrl?t.templateUrl:"partials/viewer.html"},link:function(o,i,p){function l(){m&&m.clearRect(0,0,y.width,y.height)}function s(){l();var e={url:c,withCredentials:P};g&&(e.httpHeaders=g),c&&c.length&&(n=PDFJS.getDocument(e,null,null,o.onProgress),n.then(function(e){"function"==typeof o.onLoad&&o.onLoad(),u=e,o.renderPage(o.$parent.pageToDisplay),o.$apply(function(){o.$parent.pageCount=e.numPages})},function(e){e&&"function"==typeof o.onError&&o.onError(e)}))}i.css("display","block");var c=o.pdfUrl,g=o.httpHeaders,u=null,d=isFinite(p.page)?parseInt(p.page):1,f="page-fit"===p.scale,h=p.scale>0?p.scale:1,$=p.canvasid||"pdf-canvas",y=document.getElementById($);a=p.hasOwnProperty("debug")?p.debug:!1;var P=p.usecredentials,m=y.getContext("2d"),w=angular.element(e);w.on("scroll",function(){o.$apply(function(){o.scroll=w[0].scrollY})}),PDFJS.disableWorker=!0,o.$parent.pageNum=d,o.renderPage=function(e){t&&t._internalRenderTask.cancel(),u.getPage(e).then(function(e){var n,a,p;if(f){n=e.getViewport(1);var l=i[0].getBoundingClientRect();a=l.width/n.width,h=a}n=e.getViewport(h),r(y,n.width,n.height),p={canvasContext:m,viewport:n},t=e.render(p),t.promise.then(function(){"function"==typeof o.onPageRender&&o.onPageRender()})["catch"](function(e){console.log(e)})})},o.$on("goPrevious",function(){o.$parent.pageToDisplay<=1||(o.$parent.pageToDisplay=parseInt(o.$parent.pageToDisplay)-1,o.$parent.pageNum=o.$parent.pageToDisplay)}),o.$on("goNext",function(){o.$parent.pageToDisplay>=u.numPages||(o.$parent.pageToDisplay=parseInt(o.$parent.pageToDisplay)+1,o.$parent.pageNum=o.$parent.pageToDisplay)}),o.$on("zoomIn",function(){return f=!1,h=parseFloat(h)+.2,o.renderPage(o.$parent.pageToDisplay),h}),o.$on("zoomOut",function(){return f=!1,h=parseFloat(h)-.2,o.renderPage(o.$parent.pageToDisplay),h}),o.$on("fit",function(){f=!0,o.renderPage(o.$parent.pageToDisplay)}),o.$on("changePage",function(){o.renderPage(o.$parent.pageToDisplay)}),o.$on("rotate",function(){"rotate0"===y.getAttribute("class")?y.setAttribute("class","rotate90"):"rotate90"===y.getAttribute("class")?y.setAttribute("class","rotate180"):"rotate180"===y.getAttribute("class")?y.setAttribute("class","rotate270"):y.setAttribute("class","rotate0")}),o.$watch("pageNum",function(e){o.$parent.pageToDisplay=parseInt(e),null!==u&&o.renderPage(o.$parent.pageToDisplay)}),o.$watch("pdfUrl",function(e){""!==e&&(a&&console.log("pdfUrl value change detected: ",o.pdfUrl),c=e,o.$parent.pageNum=o.$parent.pageToDisplay=d,n?n.destroy().then(function(){s()}):s())})}}}])}();
